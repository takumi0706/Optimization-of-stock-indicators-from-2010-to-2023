# 2010年から2023年の株式指標の最適化

このリポジトリには、2010年から2023年までのデータを使用して、6つの株式指標（ROE、PBR、PER、DIV、MV、MOM）の重みを最適化するPythonスクリプトが含まれています。目的は、これらの指標の累積貢献度を最大化することです。

## 指標
この最適化に使用される6つの指標は次の通りです：
- ROE: 自己資本利益率
- PBR: 株価純資産倍率
- PER: 株価収益率
- DIV: 配当利回り
- MV: 時価総額
- MOM: モメンタム

## データ
この最適化に使用されたデータは2010年から2023年までのもので、各指標の値は以下の通りです：

| 年度 | ROE       | PBR        | PER        | DIV        | MV         | MOM        |
|------|-----------|------------|------------|------------|------------|------------|
| 2010 | 0.028570  | 0.029170   | 0.038634   | 0.058942   | 0.004716   | 0.026024   |
| 2011 | -0.033860 | -0.108917  | -0.125682  | -0.023863  | -0.188233  | -0.050660  |
| 2012 | 0.183257  | 0.171121   | 0.164007   | 0.240675   | 0.217476   | 0.182905   |
| 2013 | 0.548509  | 0.545502   | 0.637857   | 0.521990   | 0.537788   | 0.716825   |
| 2014 | 0.151685  | 0.151581   | 0.173958   | 0.144985   | 0.115981   | 0.096179   |
| 2015 | 0.144554  | 0.081764   | 0.087807   | 0.131863   | 0.107831   | 0.121097   |
| 2016 | 0.034717  | 0.060462   | 0.111437   | 0.059860   | 0.003080   | -0.034814  |
| 2017 | 0.276458  | 0.225468   | 0.350787   | 0.276068   | 0.215909   | 0.319686   |
| 2018 | -0.208514 | -0.167221  | -0.197904  | -0.140971  | -0.143899  | -0.307262  |
| 2019 | 0.223685  | 0.228405   | 0.234604   | 0.123584   | 0.173009   | 0.156956   |
| 2020 | 0.123171  | -0.059502  | -0.057795  | -0.096568  | 0.102332   | 0.161247   |
| 2021 | 0.046569  | 0.196974   | 0.230826   | 0.269573   | 0.137809   | 0.017639   |
| 2022 | -0.024060 | 0.199541   | 0.171930   | 0.173264   | 0.000967   | 0.015854   |
| 2023 | 0.294335  | 0.360657   | 0.254899   | 0.377253   | 0.305017   | 0.283138   |

## 最適化の目的
このスクリプトでは、各指標の重みを最適化し、累積貢献度を最大化します。

## コードの使用方法
以下のコードを実行することで、各指標の重みを最適化し、その累積貢献度を計算します。

```python
import pyomo.environ as pyo

# モデルの作成
model = pyo.ConcreteModel(name="Stock Optimization", doc="Optimization of stock indicators from 2010 to 2023")

# 変数の定義 (ROE、PBR、PER、DIV、MV、MOM の重み)
num_indicators = 6
model.w = pyo.Var(range(1, num_indicators + 1), bounds=(0, 1), initialize=0.5)

# 指標データの定義（2010年から2023年まで）
indicators = [
    [0.028569900293578000, 0.029169621030612300, 0.038634212836734700, 0.058941791694444400, 0.004716123761467910, 0.026023502289719700],
    [-0.033859569219434000, -0.108917004247423000, -0.125681543804124000, -0.023862959229245300, -0.188232716084906000, -0.050660310697169800],
    [0.183257393695238000, 0.171120840378947000, 0.164006775873684000, 0.240675382825714000, 0.217476172952381000, 0.182905222923810000],
    [0.548508780837255000, 0.545502150301076000, 0.637857369247312000, 0.521989789215686000, 0.537788421131373000, 0.716824581078431000],
    [0.151685386475247000, 0.151581039029565000, 0.173957586203478000, 0.144985207263168000, 0.115981337891089000, 0.096178932784313700],
    [0.144553797340000000, 0.081764319681318700, 0.087807143798351600, 0.131862775160000000, 0.107830596233400000, 0.121097040960000000],
    [0.034716837612244900, 0.060462390629213400, 0.111436685235955000, 0.059859906112244900, 0.003080071612244990, -0.034813505408163300],
    [0.276458377268041000, 0.225468275286250000, 0.350787305068182000, 0.276067940680412000, 0.215908908948454000, 0.319686178061856000],
    [-0.208513565625000000, -0.167220801465517000, -0.197904335431035000, -0.140970948239583000, -0.143898870968750000, -0.307261882395833000],
    [0.223685309313830000, 0.228404933995081000, 0.234604113367174000, 0.123583787617021000, 0.173008690707447000, 0.156956025591245000],
    [0.123170903118279000, -0.059502250428235300, -0.057795450905882300, -0.096568429477419400, 0.102332428053763000, 0.161247105905376000],
    [0.046568918141304300, 0.196973690437036000, 0.230825561964655000, 0.269572626304348000, 0.137809116771739000, 0.017638768203380500],
    [-0.024060451296666700, 0.199541286682927000, 0.171929564024390000, 0.173264438333333000, 0.000967422981111188, 0.015853893355555600],
    [0.294335058865169000, 0.360656835102605000, 0.254898689781617000, 0.377252953685393000, 0.305017088101124000, 0.283137639643944000]
]

# 目的関数の定義
model.OBJ = pyo.Objective(
    expr=sum(
        sum(indicators[i][j] * model.w[j + 1] for j in range(num_indicators))
        for i in range(len(indicators))
    ),
    sense=pyo.maximize
)

# 制約条件の定義 (各指標の重みの合計が1)
model.Constraint = pyo.Constraint(expr=sum(model.w[i] for i in range(1, num_indicators + 1)) == 1)

# 最適化ソルバを設定
opt = pyo.SolverFactory('ipopt')

# 最適化計算を実行
res = opt.solve(model)

# 結果の表示
optimal_weights = [model.w[i].value for i in range(1, num_indicators + 1)]
optimal_value = model.OBJ()

indicators_names = ['ROE', 'PBR', 'PER', 'DIV', 'MV', 'MOM']

print(f"評価関数：{optimal_value:.10f}")
cumulative_contribution = 0.0
for i in range(num_indicators):
    weight_percentage = optimal_weights[i] * 100
    cumulative_contribution += weight_percentage
    print(f"{indicators_names[i]}: Weight = {optimal_weights[i]:.10f} ({weight_percentage:.10f}%), Cumulative Contribution = {cumulative_contribution:.10f}%")
```

## 使用方法

1. 必要なモジュールをインストールします。

```sh
pip install pyomo
conda install -c conda-forge ipopt
```

2. Pythonスクリプトを実行して、最適な重みと累積貢献度を確認します。

```sh
python your_script.py
```

## 結果

実行結果として、各指標の最適な重みと累積貢献度が表示されます。例えば、以下のように表示されます：

```
評価関数：0.1234567890
ROE: Weight = 0.1234567890 (12.34567890%), Cumulative Contribution = 12.34567890%
PBR: Weight = 0.2345678901 (23.45678901%), Cumulative Contribution = 35.80246791%
PER: Weight = 0.3456789012 (34.56789012%), Cumulative Contribution = 70.37035803%
DIV: Weight = 0.1234567890 (12.34567890%), Cumulative Contribution = 82.71603693%
MV: Weight = 0.0123456789 (1.23456789%), Cumulative Contribution = 83.95060482%
MOM: Weight = 0.1604938271 (16.04938271%), Cumulative Contribution = 100.00000000%
```

## 依存関係

このプロジェクトでは、以下のPythonモジュールを使用しています：

- [Pyomo](http://www.pyomo.org/)
- [Ipopt](https://coin-or.github.io/Ipopt/)

これらのモジュールは最適化問題を定義し、解決するために使用されます。

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。詳細はLICENSEファイルをご覧ください。
